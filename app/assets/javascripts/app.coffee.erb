app = angular.module("tzApp",[
  "templates"
  "ngRoute"
  "ngResource"
  "ngCookies"
  "tzControllers"
  "tzServices"
])

app.config [ "$routeProvider",
  ($routeProvider)->
    $routeProvider
      .when("/time_zones",
        templateUrl: "<%= asset_path 'templates/search_time_zone.html' %>"
        controller: "SearchTimeZoneCtrl"
        resolve:
          auth: ["Auth", (Auth)->
            Auth.get_current_user()
          ]
      )
      .when("/sign_up",
        templateUrl: "<%= asset_path 'templates/sign_up.html' %>"
        controller: "SignUpCtrl"
      )
      .when("/sign_in",
        templateUrl: "<%= asset_path 'templates/sign_in.html' %>"
        controller: "SignInCtrl"
      )
      .when("/time_zones/new",
        templateUrl: "<%= asset_path 'templates/time_zones_form.html' %>"
        controller: "NewTimeZoneCtrl"
        resolve:
          auth: ["Auth", (Auth)->
            Auth.get_current_user()
          ]
      )
      .when("/time_zones/:id",
        templateUrl: "<%= asset_path 'templates/time_zones_form.html' %>"
        controller: "EditTimeZoneCtrl"
        resolve:
          auth: ["Auth", (Auth)->
            Auth.get_current_user()
          ]
      )
      .otherwise("/time_zones")
]

app.run ["$rootScope","$location", ($rootScope,$location)->
  $rootScope.$on "$routeChangeError", (event)->
    $location.path "/sign_in"

]
